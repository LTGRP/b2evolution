!function(t){function i(){var i=t('<div style="width: 100%; height:200px;">test</div>'),e=t('<div style="width:200px;height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(i),s=i[0],o=e[0];t("body").append(o);var n=s.offsetWidth;e.css("overflow","scroll");var c=o.clientWidth;return e.remove(),n-c}function e(t,i){return new e.prototype.init(t,i)}var s=0;t.fn.stickyRows=function(i){var s=[],o=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var e=t.data(this,"stickyRows");if("undefined"==typeof e||!t.isFunction(e[i]))return t.error('No such method "'+i+'" for stickyRows');var n=e[i].apply(e,o);void 0!==n&&n!==e&&s.push(n)}):this.each(function(){t(this).is(".sticky-table-for-shifting, .sticky-table")||(t.data(this,"stickyRows")?t.data(this,"stickyRows").setRowSets().calculateDimensions().redraw("init"):t.data(this,"stickyRows",e(this,i)))}),0===s.length?this:1===s.length?s[0]:s},t.StickyRows=e,t.StickyRows.opts={container:"body",rows:"thead",scrollWidth:"auto",containersToSynchronize:!1,performanceDebugging:!1},e.fn=t.StickyRows.prototype={init:function(e,o){var n=this;return this.document=document,this.window=window,this.body=t("body"),this.uuid=s++,this.table={$element:t(e)},this.opts=t.extend({},t.StickyRows.opts,this.table.$element.data(),o),this.opts.performanceDebugging&&console.time("initialize stickyRows"),this.opts.scrollWidth="auto"==this.opts.scrollWidth?i():this.opts.scrollWidth,this.container={$element:this.table.$element.closest(this.opts.container)},this.container.isBody=this.container.$element.is("body"),this.container.isBodyScrollable=!1,this.scroll={vertical:!1,horizontal:!1,mode:"scrolling",shiftToRow:-1},this.setRowSets(),this.setContainersToSynchronize(),this.calculateDimensions(),this.opts.performanceDebugging&&console.timeEnd("initialize stickyRows"),this.container.isBody?t(this.document).off(".stickyRowsRedraw"+s).on("scroll.stickyRowsRedraw"+s,t.proxy(this.redraw,this)):this.container.$element.off(".stickyRowsRedraw"+s).on("scroll.stickyRowsRedraw"+s,t.proxy(this.redraw,this)),t(this.window).off(".stickyRowsCalc"+s).on("resize.stickyRowsCalc"+s,t.proxy(this.calculateDimensions,this)),"undefined"==typeof ResizeSensor||this.container.$element.is("body")||new ResizeSensor(this.container.$element,t.proxy(this.calculateDimensions,this)),this.containersToSynchronize&&(this.containersToSynchronize.each(function(){return t(this).is("body")?(n.container.isBodyScrollable=!0,t(n.document).off(".stickyRowsCalc"+s).on("scroll.stickyRowsCalc"+s,t.proxy(n.calculateDimensions,n)),!1):void 0}),this.containersToSynchronize.not("body").off(".stickyRowsCalc"+s).on("scroll.stickyRowsCalc"+s,t.proxy(this.calculateDimensions,this))),this.redraw("init"),this},destroy:function(){this.container.isBody?t(this.document).off(".stickyRowsRedraw"+s):this.container.$element.off(".stickyRowsRedraw"+s),t(this.window).off(".stickyRowsCalc"+s),this.containersToSynchronize&&(this.containersToSynchronize.each(function(){return t(this).is("body")?(t(self.document).off(".stickyRowsCalc"+s),!1):void 0}),this.containersToSynchronize.off(".stickyRowsCalc"+s)),this.container.$element.children("div.resize-sensor").remove(),this.stickyHead.$element.remove(),this.body=null,this.container=null,this.containersToSynchronize=null,this.document=null,this.rowSets=null,this.stickyHead=null,this.stickyNow=null,this.table=null,this.window=null},redraw:function(t){var i=t&&"init"==t;if(this.blocked)return this;this.opts.performanceDebugging&&console.time("stickyRows redraw"),this.blocked=!0;var e=this.container.$element.scrollTop(),s=this.container.$element.scrollLeft();return this.scroll.vertical=!1,this.scroll.horizontal=!1,(e!=this.container.scroll.top||i)&&(this.scroll.vertical=e>this.container.scroll.top?"down":"up",this.container.scroll.top=e,this.table.offset.top-this.container.offset.top>e||this.table.offset.top-this.container.offset.top+this.table.height<e?this.stickyHead.$element.hasClass("hidden")||(this.stickyNow=[],this.stickyHead.$element.addClass("hidden"),this.stickyHead.$table.empty(),this.stickyHead.$tableForShifting.empty().addClass("hidden")):(this.searchCurrentStickyRows(),this.renderStickyRows())),(s!=this.container.scroll.left||i)&&(this.scroll.horizontal=s>this.container.scroll.left?"right":"left",this.container.scroll.left=s,this.setHorizontalOffset()),this.blocked=!1,this.opts.performanceDebugging&&console.timeEnd("stickyRows redraw"),this},setRowSets:function(){var i=this,e=i.opts.rows;return i.rowSets=[],i.stickyNow=[],t.isFunction(e)?t.each(e(),function(e,s){i.rowSets.push(t.map(s.get().reverse(),function(i){return{$row:t(i)}}))}):e instanceof jQuery?i.rowSets.push(t.map(e.get().reverse(),function(i){return{$row:t(i)}})):"string"==typeof e?i.rowSets.push(t.map(i.table.$element.children(e).get().reverse(),function(i){return{$row:t(i)}})):t.isArray(e)?t.each(e,function(e,s){i.rowSets.push(t.map(i.table.$element.children(s).get().reverse(),function(i){return{$row:t(i)}}))}):t.error("stickyRows.rows has incorrect format."),this},setContainersToSynchronize:function(){var i=this;if(i.opts.containersToSynchronize){var e=i.opts.containersToSynchronize;i.containersToSynchronize=[],t.isFunction(e)?i.containersToSynchronize=e():e instanceof jQuery?i.containersToSynchronize=e:"string"==typeof e?i.containersToSynchronize=t(e):t.isArray(e)?i.containersToSynchronize=t(e.join(",")):t.error("stickyRows.containersToSynchronize has incorrect format.")}return this},calculateDimensions:function(){var i,e=this;if(this.blocked)return this;this.opts.performanceDebugging&&console.time("stickyRows: calculate dimensions"),this.blocked=!0,this.container.offset=this.container.$element.offset(),this.container.width=this.container.$element.outerWidth()-this.opts.scrollWidth,this.container.scroll={top:this.container.$element.scrollTop(),left:this.container.$element.scrollLeft()},this.table.width=this.table.$element.outerWidth(),this.table.height=this.table.$element.height(),this.table.offset=this.table.$element.offset(),e.container.isBody||(this.table.offset.top=this.table.offset.top+this.container.scroll.top),t.each(e.rowSets,function(s,o){t.each(o,function(t,s){i=s.$row.offset(),s.offset={top:i.top-e.container.offset.top+(e.container.isBody?0:e.container.scroll.top),left:i.left-e.container.offset.left},s.height=s.$row.outerHeight()})});var s={top:0,left:0};if(this.container.isBodyScrollable&&(s={top:this.body.scrollTop(),left:this.body.scrollLeft()}),this.stickyHead)this.stickyHead.$element.css({top:this.container.offset.top-s.top,left:this.table.offset.left+this.container.scroll.left-s.left,width:this.container.width}),this.stickyHead.$table.css({width:this.table.width}),this.stickyHead.$tableForShifting.css({width:this.table.width});else{var o=t("<div/>").addClass("sticky-header hidden").css({top:this.container.offset.top-s.top,left:this.table.offset.left+this.container.scroll.left-s.left,width:this.container.width}).insertBefore(this.table.$element),n=t("<table/>").addClass("sticky-table").addClass(this.table.$element.attr("class")).css({width:this.table.width}).appendTo(o),c=n.clone().addClass("sticky-table-for-shifting hidden").appendTo(o);this.stickyHead={$element:o,$table:n,$tableForShifting:c,height:0,marginTop:0,changed:!1}}return this.blocked=!1,this.opts.performanceDebugging&&console.timeEnd("stickyRows: calculate dimensions"),this},searchCurrentStickyRows:function(){var i,e=this,s=this.container.scroll.top,o=this.container.scroll.top+this.stickyHead.height,n=[];"up"==e.scroll.vertical&&(e.scroll.mode="scrolling",e.scroll.shiftToRow=-1),t.each(this.rowSets,function(c,r){for(s=e.container.scroll.top,i=c;i--;)n[i]&&(s+=n[i].height);t.each(r,function(t,i){if(!n.length||n[c-1]&&n[c-1].offset.top<i.offset.top){if("down"==e.scroll.vertical&&i.offset.top<=o&&i.offset.top>=s)return e.stickyNow[c]&&e.stickyNow[c].$row!=i.$row&&("scrolling"==e.scroll.mode||e.scroll.shiftToRow==c&&e.stickyNow[e.stickyNow.length-1].$row!=i.$row)&&("shifting"==e.scroll.mode&&e.stickyNow.splice(c,1),e.stickyNow.push(i),e.scroll.mode="shifting",e.scroll.shiftToRow=c),!1;if(i.offset.top<s)return n.push(i),e.stickyNow[c]&&e.stickyNow[c].$row==i.$row||(e.stickyHead.changed=!0,e.scroll.mode="scrolling",e.scroll.shiftToRow=-1),!1}})}),(this.stickyHead.changed||this.stickyNow.length!=n.length)&&("scrolling"==this.scroll.mode&&(this.stickyNow=n),this.stickyHead.changed=!0)},renderStickyRows:function(){var i,e=this,s=0,o=0;this.stickyHead.changed&&(this.stickyHead.$table.empty(),e.stickyHead.$tableForShifting.empty(),this.stickyNow.length?(this.stickyHead.$element.removeClass("hidden"),t.each(this.stickyNow,function(t,i){o+=i.height,e.stickyHead.$table.append(e.getCloneOfRow(i))})):this.stickyHead.$element.addClass("hidden"),"scrolling"==e.scroll.mode?(e.stickyHead.$tableForShifting.addClass("hidden"),this.stickyHead.height=o):e.scroll.shiftToRow&&(e.stickyHead.$tableForShifting.removeClass("hidden"),e.stickyHead.$table.children(":lt("+e.scroll.shiftToRow+")").clone().appendTo(e.stickyHead.$tableForShifting)),this.stickyHead.changed=!1),"shifting"==this.scroll.mode&&(i=this.stickyNow[this.stickyNow.length-1],s=i.offset.top-this.container.scroll.top-this.stickyHead.height),this.table.height+this.table.offset.top<=this.container.scroll.top+this.stickyHead.height&&this.table.height+this.table.offset.top>=this.container.scroll.top&&(s=e.table.offset.top+e.table.height+1-this.container.scroll.top-this.stickyHead.height),this.stickyHead.marginTop!=s&&(this.stickyHead.marginTop=s,this.stickyHead.$table.css({"margin-top":s}))},setHorizontalOffset:function(){this.stickyHead.$table.css({"margin-left":-this.container.scroll.left}),this.stickyHead.$tableForShifting.css({"margin-left":-this.container.scroll.left})},getRowCells:function(t){return t.is("thead, tbody")?t.children().children():t.children()},getCloneOfRow:function(i){var e;return i.$clone||(i.$clone=i.$row.clone(),e=this.getRowCells(i.$clone),t.each(this.getRowCells(i.$row),function(i,s){e.eq(i).css("width",t(s).width())})),i.$clone}},e.prototype.init.prototype=e.prototype}(jQuery);